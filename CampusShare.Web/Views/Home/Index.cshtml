@model CampusShare.Web.ViewModels.AlumnoHomeViewModel
@{
    ViewData["Title"] = "Home - CampusShare";
}

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .welcome-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .welcome-section h2 {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .filter-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .filter-section label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: block;
        }

        .form-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            font-size: 1.1rem;
        }

        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
        }

        .items-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .items-container h4 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .item-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: #fafbfc;
        }

        .item-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .badge-estado {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-pendiente {
            background: #ffc107;
            color: #000;
        }

        .badge-aprobada {
            background: #28a745;
            color: white;
        }

        .badge-vigente {
            background: #17a2b8;
            color: white;
        }

        .badge-cancelada,
        .badge-realizada {
            background: #6c757d;
            color: white;
        }

        .badge-rechazada {
            background: #dc3545;
            color: white;
        }

        .item-details {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .item-details p {
            margin-bottom: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            border-radius: 8px;
            padding: 8px 20px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
        }

        .btn-crear {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-crear:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .btn-editar {
            background: #17a2b8;
            color: white;
        }

        .btn-editar:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .btn-tomar {
            background: #28a745;
            color: white;
        }

        .btn-tomar:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-devolver {
            background: #007bff;
            color: white;
        }

        .btn-devolver:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-cancelar {
            background: #dc3545;
            color: white;
        }

        .btn-cancelar:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .main-action-btn {
            margin-bottom: 20px;
        }
    </style>
</head>
<nav class="navbar navbar-expand-lg navbar-dark mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div class="container-fluid">
        <a class="navbar-brand" href="@Url.Action("Index", "Home")" style="color: white; font-weight: 700; font-size: 1.5rem;">
            <i class="bi bi-mortarboard-fill me-2"></i>CampusShare
        </a>
        <div class="ms-auto d-flex align-items-center">
            <span class="navbar-text me-3" style="color: white;">
                <i class="bi bi-person-circle me-2"></i>
                <strong>@Model.NombreAlumno</strong>
            </span>
            <form asp-controller="Account" asp-action="Logout" method="post" style="display: inline;">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-box-arrow-right me-1"></i>Cerrar Sesión
                </button>
            </form>
        </div>
    </div>
</nav>
<body>
    <div class="container mt-4">
        <div class="welcome-section">
            <h2><i class="bi bi-house-door-fill me-2"></i>Bienvenido, @Model.NombreAlumno</h2>
            <p class="text-muted mb-0">Gestiona tus reservas y préstamos de manera simple</p>
        </div>

        <div class="filter-section">
            <label for="tipoSelect">
                <i class="bi bi-funnel-fill me-2"></i>Reservas / Préstamos
            </label>
            <select class="form-select" id="tipoSelect">
                <option value="reservas" selected>📋 Mis Reservas</option>
                <option value="prestamos">📦 Mis Préstamos</option>
            </select>
        </div>

        <div class="items-container">
            <a href="@Url.Action("Create", "Reservas")" class="btn btn-action btn-crear main-action-btn" id="btnCrear">
                <i class="bi bi-plus-circle me-2"></i>Crear Nueva Reserva
            </a>

            <div id="reservasSection">
                <h4><i class="bi bi-calendar-check me-2"></i>Mis Reservas</h4>

                @if (Model.Reservas.Any())
                {
                    foreach (var reserva in Model.Reservas)
                    {
                        <div class="item-card">
                            <div class="item-header">
                                <span class="item-title">
                                    <i class="bi bi-box-seam me-2"></i>@(reserva.Articulo?.Nombre ?? "Sin artículo")
                                </span>
                                <span class="badge-estado badge-@reserva.Estado.ToString().ToLower()">
                                    @switch (reserva.Estado)
                                    {
                                        case EstadoRP.Pendiente:
                                            <i class="bi bi-clock-history me-1"></i>
                            
                                            <text>PENDIENTE</text>
                                            break;
                                        case EstadoRP.Aprobada:
                                            <i class="bi bi-check-circle me-1"></i>
                            
                                            <text>APROBADA</text>
                                            break;
                                        case EstadoRP.Cancelada:
                                            <i class="bi bi-x-circle me-1"></i>
                            
                                            <text>CANCELADA</text>
                                            break;
                                        case EstadoRP.Rechazada:
                                            <i class="bi bi-x-circle me-1"></i>
                            
                                            <text>RECHAZADA</text>
                                            break;
                                        case EstadoRP.Realizada:
                                            <i class="bi bi-check-circle me-1"></i>
                            
                                            <text>REALIZADA</text>
                                            break;
                                    }
                                </span>
                            </div>
                            <div class="item-details">
                                <p><strong>Fecha Inicio:</strong> @reserva.FecInicio.ToString("dd/MM/yyyy")</p>
                                <p><strong>Fecha Fin:</strong> @reserva.FecFin.ToString("dd/MM/yyyy")</p>
                                <p><strong>Solicitada:</strong> @reserva.FechaSolicitud.ToString("dd/MM/yyyy HH:mm")</p>
                                @if (!string.IsNullOrEmpty(reserva.MotivoRechazo))
                                {
                                    <p><strong>Motivo:</strong> <em>@reserva.MotivoRechazo</em></p>
                                }
                            </div>
                            <div class="action-buttons">
                                @if (reserva.Estado == EstadoRP.Pendiente)
                                {
                                    <a href="@Url.Action("Edit", "Reservas", new { id = reserva.Id })"
                                        class="btn btn-action btn-editar">
                                        <i class="bi bi-pencil me-1"></i>Editar
                                    </a>
                                    <form asp-controller="Reservas" asp-action="Cancelar" asp-route-id="@reserva.Id" method="post"
                                        style="display:inline;"
                                        onsubmit="return confirm('¿Está seguro que desea cancelar esta reserva?');">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-action btn-cancelar">
                                            <i class="bi bi-x-circle me-1"></i>Cancelar
                                        </button>
                                    </form>
                                }
                                else if (reserva.Estado == EstadoRP.Aprobada)
                                {
                                    <form asp-controller="Prestamos" asp-action="TomarDesdReserva" asp-route-id="@reserva.Id"
                                        method="post" style="display:inline;">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-action btn-tomar">
                                            <i class="bi bi-box-arrow-down me-1"></i>Tomar Préstamo
                                        </button>
                                    </form>
                                    <form asp-controller="Reservas" asp-action="Cancelar" asp-route-id="@reserva.Id" method="post"
                                        style="display:inline;"
                                        onsubmit="return confirm('¿Está seguro que desea cancelar esta reserva?');">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-action btn-cancelar">
                                            <i class="bi bi-x-circle me-1"></i>Cancelar
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <span class="text-muted"><i class="bi bi-info-circle me-1"></i>No hay acciones
                                        disponibles</span>
                                }
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <i class="bi bi-calendar-x"></i>
                        <h5>No tienes reservas</h5>
                        <p>Comienza creando una nueva reserva</p>
                    </div>
                }
            </div>

            <div id="prestamosSection" style="display: none;">
                <h4><i class="bi bi-box-seam me-2"></i>Mis Préstamos</h4>

                @if (Model.Prestamos.Any())
                {
                    foreach (var prestamo in Model.Prestamos)
                    {
                        <div class="item-card">
                            <div class="item-header">
                                <span class="item-title">
                                    <i class="bi bi-box me-2"></i>@(prestamo.Articulo?.Nombre ?? "Sin artículo")
                                </span>
                                <span class="badge-estado badge-@prestamo.Estado.ToString().ToLower()">
                                    @if (prestamo.Estado == EstadoRP.Vigente)
                                    {
                                        <i class="bi bi-arrow-repeat me-1"></i>
                            
                                        <text>VIGENTE</text>
                                    }
                                    else
                                    {
                                        <i class="bi bi-check-circle me-1"></i>
                            
                                        <text>DEVUELTO</text>
                                    }
                                </span>
                            </div>
                            <div class="item-details">
                                <p><strong>Fecha Inicio:</strong> @prestamo.FecInicio.ToString("dd/MM/yyyy")</p>
                                <p><strong>Fecha Fin:</strong> @prestamo.FecFin.ToString("dd/MM/yyyy")</p>
                                @if (prestamo.Estado == EstadoRP.Vigente)
                                {
                                    var diasRestantes = (prestamo.FecFin - DateTime.Now).Days;
                                    <p><strong>Días restantes:</strong> <span
                                            class="@(diasRestantes <= 3 ? "text-danger" : "text-success") fw-bold">@diasRestantes
                                            días</span></p>
                                }
                            </div>
                            <div class="action-buttons">
                                @if (prestamo.Estado == EstadoRP.Vigente)
                                {
                                    <form asp-controller="Prestamos" asp-action="Devolver" asp-route-id="@prestamo.Id" method="post"
                                        style="display:inline;"
                                        onsubmit="return confirm('¿Confirma la devolución de este préstamo?');">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-action btn-devolver">
                                            <i class="bi bi-box-arrow-up me-1"></i>Devolver
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <span class="text-muted"><i class="bi bi-check-circle me-1"></i>Préstamo finalizado</span>
                                }
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <i class="bi bi-box-seam"></i>
                        <h5>No tienes préstamos</h5>
                        <p>Los préstamos se generan desde reservas aprobadas</p>
                    </div>
                }
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const tipoSelect = document.getElementById('tipoSelect');
        const reservasSection = document.getElementById('reservasSection');
        const prestamosSection = document.getElementById('prestamosSection');
        const btnCrear = document.getElementById('btnCrear');

        tipoSelect.addEventListener('change', function () {
            if (this.value === 'reservas') {
                reservasSection.style.display = 'block';
                prestamosSection.style.display = 'none';
                btnCrear.style.display = 'block';
            } else {
                reservasSection.style.display = 'none';
                prestamosSection.style.display = 'block';
                btnCrear.style.display = 'none';
            }
        });
    </script>
</body>

</html>